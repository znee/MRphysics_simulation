<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRI K-Space Visualization</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <header>
            <div class="header-row">
                <a href="../index.html" class="back-link">&larr; Home</a>
                <div class="header-titles">
                    <h1>MRI K-Space & Image Reconstruction</h1>
                    <p class="subtitle">Visualizing the relationship between Spatial Frequency and Image Domain</p>
                </div>
            </div>
        </header>

        <main class="visualization-grid">
            <!-- Visualization Grid -->
            <div class="column-group" id="image-space-col">
                <!-- Top Left: Original Image -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>Original Object</h2>
                    </div>
                    <div class="canvas-container" style="position: relative;">
                        <canvas id="originalCanvas" width="512" height="512"></canvas>
                        <div class="encoding-guide phase-guide">
                            <span class="arrow">↓</span>
                            <span class="label">Phase (PE)</span>
                        </div>
                        <div class="encoding-guide freq-guide">
                            <span class="arrow">→</span>
                            <span class="label">Freq (FE)</span>
                        </div>
                    </div>
                </div>
                <!-- Bottom Left: K-Space Magnitude -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>K-Space Magnitude</h2>
                    </div>
                    <div class="canvas-container">
                        <canvas id="kspaceMagCanvas" width="512" height="512"></canvas>
                    </div>
                </div>
            </div>

            <div class="column-group" id="k-space-col">
                <!-- Top Right: Reconstructed Image -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>Reconstructed Image</h2>
                    </div>
                    <div class="canvas-container">
                        <canvas id="reconstructedCanvas" width="512" height="512"></canvas>
                    </div>
                </div>
                <!-- Bottom Right: K-Space Phase -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>K-Space Phase</h2>
                    </div>
                    <div class="canvas-container">
                        <canvas id="kspacePhaseCanvas" width="512" height="512"></canvas>
                    </div>
                </div>
            </div>

            <!-- Controls & Explanations -->
            <section class="panel controls-panel">
                <div class="panel-header">
                    <h2>Controls</h2>
                </div>
                <div class="controls-content">
                    <div class="control-group">
                        <h3>Phantom</h3>
                        <select id="phantomSelect">
                            <option value="circle">Circle</option>
                            <option value="square">Square</option>
                            <option value="brain">Brain (Simulated)</option>
                            <option value="brain-real" selected>Brain (Real)</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label>Animation Speed</label>
                        <input type="range" id="speedRange" min="1" max="20" value="5">
                    </div>

                    <div class="control-group">
                        <label>Noise Level</label>
                        <input type="range" id="noiseRange" min="0" max="100" value="0">
                    </div>

                    <div class="control-group">
                        <label>Motion Artifacts</label>
                        <input type="range" id="motionRange" min="0" max="100" value="0">
                    </div>

                    <div class="control-group">
                        <label>Spike Noise (Bad Pixel)</label>
                        <div class="sub-control">
                            <input type="checkbox" id="spikeCheck">
                            <label for="spikeCheck">Enable</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Undersampling (Skip Lines)</label>
                        <div class="sub-control">
                            <label>Phase (Y): <span id="skipYVal">1</span>x</label>
                            <input type="range" id="skipYRange" min="1" max="8" value="1" step="1">
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>Acceleration Techniques</h3>
                        <label>Partial Fourier</label>
                        <select id="partialFourierSelect">
                            <option value="1.0" selected>Full (100%)</option>
                            <option value="0.75">6/8 (75%)</option>
                            <option value="0.625">5/8 (62.5%)</option>
                        </select>
                        <div class="sub-control" id="pfReconControl" style="display: none; margin-top: 5px;">
                            <label>Reconstruction:</label>
                            <select id="pfReconSelect" style="margin-left: 5px;">
                                <option value="zerofill">Zero-fill</option>
                                <option value="conjugate">Conjugate Synthesis</option>
                            </select>
                        </div>

                        <label style="margin-top: 10px;">Parallel Imaging (Demo)</label>
                        <select id="parallelImagingSelect">
                            <option value="1" selected>Off (1 coil)</option>
                            <option value="2">SENSE R=2 (2 coils)</option>
                            <option value="4">SENSE R=4 (4 coils)</option>
                        </select>
                        <em style="font-size: 0.65rem; opacity: 0.7; display: block; margin-top: 3px;">
                            Simplified demo - interpolates missing k-space lines
                        </em>
                    </div>

                    <div class="control-group resolution-group">
                        <h3>Resolution & SNR</h3>
                        <label>Matrix Size: <span id="matrixSizeVal">256</span> x <span id="matrixSizeVal2">256</span></label>
                        <input type="range" id="matrixSizeRange" min="32" max="512" value="256" step="32">
                        <div class="sub-control">
                            <input type="checkbox" id="simulateSNRCheck" checked>
                            <label for="simulateSNRCheck">Simulate SNR effect</label>
                        </div>
                        <div class="resolution-info">
                            <div class="info-row">
                                <span class="info-label">Pixel Size:</span>
                                <span id="pixelSizeVal" class="info-value">1.0x</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">K-Space Coverage:</span>
                                <span id="kspaceCoverageVal" class="info-value">100%</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Relative SNR:</span>
                                <span id="snrVal" class="info-value">1.00</span>
                            </div>
                            <div class="snr-bar-container">
                                <div class="snr-bar" id="snrBar"></div>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <button id="btnStartFill" class="primary-btn">Start Filling Animation</button>
                        <button id="btnStopFill" class="secondary-btn">Stop</button>
                        <button id="btnAcquireAll" class="secondary-btn">Acquire All</button>
                        <button id="btnClear" class="danger-btn">Clear K-Space</button>
                    </div>

                    <div class="info-box">
                        <h3>Current Status</h3>
                        <p id="statusText">Ready</p>
                    </div>

                    <div class="info-box explanation-box">
                        <h3>Resolution & K-Space</h3>
                        <p class="explanation-text">
                            <strong>Baseline (256):</strong> Uses 25% of full k-space. SNR = 1.0.
                        </p>
                        <p class="explanation-text">
                            <strong>Lower Resolution:</strong> Truncates more k-space. Larger voxels → higher SNR.
                        </p>
                        <p class="explanation-text">
                            <strong>Higher Resolution:</strong> Uses more k-space. Smaller voxels → lower SNR. 512×512 = 0.25× SNR.
                        </p>
                    </div>

                    <div class="info-box explanation-box">
                        <h3>K-Space Inspection</h3>
                        <p class="explanation-text">
                            <strong>Hover over K-Space Magnitude</strong> to see the corresponding spatial frequency pattern.
                        </p>
                        <p class="explanation-text">
                            Each k-space point represents a 2D sinusoidal wave. <strong>Center</strong> = low frequency (contrast), <strong>Edges</strong> = high frequency (fine detail).
                        </p>
                    </div>

                    <div class="info-box explanation-box">
                        <h3>Acceleration Techniques</h3>
                        <p class="explanation-text">
                            <strong>Partial Fourier:</strong> Exploits k-space conjugate symmetry. Acquires ~60-75% of ky lines. Faster scan, slight blur/artifacts.
                        </p>
                        <p class="explanation-text">
                            <strong>Parallel Imaging:</strong> Uses multiple coils to unfold aliased images. SENSE/GRAPPA recover missing data. SNR ∝ 1/(g·√R).
                        </p>
                        <p class="explanation-text" style="margin-top: 8px; font-size: 0.7rem;">
                            <strong>K-Space Colors:</strong> <span style="color: #fff;">White</span> = acquired, <span style="color: #4dd;">Cyan</span> = PI-recovered, <span style="color: #666;">Dark</span> = missing.
                        </p>
                        <p class="explanation-text" style="margin-top: 8px; font-size: 0.65rem; opacity: 0.8; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px;">
                            <strong>Note:</strong> This PI demo uses k-space interpolation to fill skipped lines, which shows the SNR penalty (g-factor noise) but not true wrap-around aliasing artifacts. Real SENSE/GRAPPA reconstructs aliased images first, then unfolds using coil sensitivity maps.
                        </p>
                    </div>

                    <div class="sidebar-footer">
                        <p>Jinhee Jang, MD, PhD</p>
                        <p>Department of Radiology, Seoul St. Mary's Hospital</p>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <script src="brain_data.js"></script>
    <script src="script.js"></script>
</body>

</html>